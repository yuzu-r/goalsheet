

<h3>My Dashboard</h3>
<h4>Hi, <%= current_user.email %>. Here's what's up for today:</h4>
<% if @plans.empty? %>
  No goals are being tracked for today. Add some and get going!
<% else %>
  Today so far:
  <table>
    <tr>
      <th>Goal</th>
      <th>Target Session Length</th>
      <th>Toggle Timer</th>
      <th>Elapsed Time</th>
      <th>Mark Goal Complete</th>
      <th>Remove Goal for Today</th>
    </tr>
    <% @plans.each do |plan| %>
      <tr>
        <td><%= plan.goal.title %></td>
        <td><%= plan.goal.session_length %></td>
        <td>start/stop</td>
        <td> 2:13</td>
        <% if plan.is_complete %>
          <td> 
            <input type="checkbox" class= "toggle-complete" data-id= <%= plan.id %> checked > 
          </td>
        <% else %>
          <td>
            <input type="checkbox" class= "toggle-complete" data-id= <%= plan.id %> >
          </td>
        <% end %>
        <td>remove goal</td>
      </tr>
    <% end %>
  </table>

<% end %>

<h4> Available goals: </h4>
<ul>
  <% current_user.goals.each do |g| %> 
    <li>
      <%= g.title %> <%= link_to 'start tracking', dashboard_plans_path(@plan, goal_id: g.id), method: :post %>
    </li>
  <% end %>
</ul>

<script>
  $('.toggle-complete').on('click', function() {
    var planId = $(event.target).data('id');
    toggleComplete(planId);
  })

  function toggleComplete(planId) {
    var toggleUrl = "/dashboard/plans/"+planId +"/mark_complete";
    console.log(toggleUrl);
    var data = {_method: 'PATCH'};
    $.post(toggleUrl, data)
      .done(function(data){
        console.log('success!');
      })
      .fail(function(xhr, textStatus, errorThrown) {
        console.log('failed to update plan!');
        console.log(xhr.statusText);
        console.log(textStatus);
        console.log(errorThrown);
      });
  }

</script>
